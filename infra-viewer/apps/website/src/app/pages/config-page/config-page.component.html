<div class="uk-container">
  <h1 class="uk-heading-medium uk-heading-bullet">Configuration</h1>
  <p>On this page you can quickly configure the infraviewer</p>
  <button class="uk-button uk-button-primary" type="button" (click)="getInformation(true)">Refresh config</button>

  <ul uk-accordion *ngIf="configuration">
    <li class="uk-open">
      <h2 class="uk-accordion-title">Configuration</h2>
      <div class="uk-accordion-content">
        <section class="layers">
          <h3 class="uk-heading-divider">Layers</h3>
          <ul class="uk-list uk-list-disc uk-list-primary uk-list-divider">
            <li *ngFor="let layer of configuration.layers">
              <ng-template *ngTemplateOutlet="layerTemplate; context: {layer: layer, type: layer.type} "></ng-template>
            </li>
          </ul>
        </section>
      </div>
    </li>
    <li>
      <h2 class="uk-accordion-title">Advanced Config</h2>
      <section class="uk-accordion-content">
        <form class="uk-form-stacked" #advancedForm="ngForm" (ngSubmit)="onAdvancedConfigSubmit()">
          <div>
            <label class="uk-form-label">Configuration JSON</label>
            <div class="uk-form-controls">
            <textarea class="uk-textarea uk-height-viewport" name="advancedConfiguration"
                      [(ngModel)]="configurationString"></textarea>
            </div>
          </div>
          <button type="submit" [disabled]="advancedForm.invalid"
                  class="uk-margin-small-top uk-button uk-button-primary">Submit
          </button>
        </form>
      </section>
    </li>
  </ul>
</div>

<div id="details-pane" #modal class="uk-modal-container" uk-modal="esc-close:false;bg-close:false;">
  <div class="uk-modal-dialog">
    <button class="uk-modal-close-default" type="button" uk-close (click)="cancelEdit()"></button>

    <div class="uk-modal-header">
      <h2 class="uk-modal-title">Layer Details</h2>
      <p>Configure a (new) layer here.</p>
    </div>

    <form #layerConfig="ngForm" (ngSubmit)="onLayerConfigSave()" *ngIf="selectedLayer">
      <div class="uk-modal-body">
        <div class="uk-margin">
          <label class="uk-form-label">Title</label>
          <div class="uk-form-controls">
            <input class="uk-input" type="text" name="title" [(ngModel)]="selectedLayer.title" required>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="url">URL</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="url" name="url" type="text" [(ngModel)]="selectedLayer.url" required>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="minScale">Min Scale</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="minScale" name="minScale" type="number" step="100"
                   [(ngModel)]="selectedLayer.minScale">
          </div>
        </div>
        <div class="uk-margin uk-grid uk-child-width-expand" *ngIf="selectedLayer.elevationInfo;else noElevationInfo">
          <div>
            <label class="uk-form-label" for="elevationMode">Elevation Mode</label>
            <div class="uk-form-controls">
              <select class="uk-select" id="elevationMode" name="elevationMode"
                      [(ngModel)]="selectedLayer.elevationInfo.mode">
                <option value="on-the-ground">On the ground</option>
                <option value="relative-to-ground">Relative to ground</option>
                <option value="relative-to-scene">Relative to scene</option>
                <option value="absolute-height">Absolute height</option>
              </select>
            </div>
          </div>
          <div>
            <label class="uk-form-label" for="units">Units</label>
            <div class="uk-form-controls">
              <select class="uk-select" id="units" name="units"
                      [(ngModel)]="selectedLayer.elevationInfo.unit">
                <option value="centimeters">Centimeters</option>
                <option value="meters">Meters</option>
                <option value="kilometers">Kilometers</option>
                <option value="us-feet">US Feet</option>
                <option value="feet">Feet</option>
                <option value="miles">Miles</option>
                <option value="yards">Yards</option>
              </select>
            </div>
          </div>
          <div>
            <label class="uk-form-label" for="offset">Offset</label>
            <div class="uk-form-controls">
              <input class="uk-input" id="offset" name="offset" type="number" step="0.1"
                     [(ngModel)]="selectedLayer.elevationInfo.offset">
            </div>
          </div>
        </div>

        <div class="uk-flex uk-flex-between uk-border-bottom">
          <h3>Renderer</h3>
          <button type="button" class="uk-button uk-button-default uk-button-small" (click)="addUniqueValue()">
            <span uk-icon="icon: plus"></span>
          </button>
        </div>
        <div class="uk-margin" *ngIf="selectedLayer.renderer;else noRenderer">
          <ul uk-accordion>
            <li
              *ngFor="let uniqueValueInfo of (selectedLayer.renderer | cast: UniqueValueRenderer).uniqueValueInfos; let i = index">
              <a class="uk-accordion-title">Symbol layer no. {{i + 1}}</a>
              <hr class="uk-divider-small">
              <div class="uk-accordion-content">
                <label class="uk-form-label" for="value">Value</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="value" name="value" type="text" [(ngModel)]="uniqueValueInfo.value">
                </div>
                <ng-template *ngTemplateOutlet="symboleditor; context: {symbol: uniqueValueInfo.symbol} "></ng-template>
              </div>

            </li>
          </ul>
        </div>
      </div>

      <div class="uk-modal-footer uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button" (click)="cancelEdit()">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
      </div>
    </form>
  </div>
</div>

<ng-template #noElevationInfo>
  <div>
    <button class="uk-button uk-button-default" (click)="addElevationInfo()">Add elevation info</button>
  </div>
</ng-template>
<ng-template #noRenderer>
  <button class="uk-button uk-button-primary" type="button" (click)="createRenderer()">Create Renderer</button>
</ng-template>

<ng-template #layerTemplate let-layer="layer" let-type="type">
  <div class="uk-flex uk-flex-between">
    <div uk-toggle="target: #details-pane" class="uk-width-1-1" (click)="selectLayer(layer)">
      <ng-container [ngSwitch]="type">
        <span *ngSwitchCase="'scene'" uk-icon="icon: world"></span>
        <span *ngSwitchCase="'geoJSON'" uk-icon="icon: code"></span>
        <span *ngSwitchCase="'feature'" uk-icon="icon: location"></span>
        <span *ngSwitchDefault uk-icon="icon: question"></span>
      </ng-container>
      <span class="uk-margin-small-left"
            [class.uk-text-warning]="!layer.title">{{layer.title || "Unknown Title"}}</span>
    </div>
    <div class="uk-flex">
      <button class="uk-button uk-button-default uk-button-small" (click)="toggleVisibility(layer)">
        <span uk-icon="icon: check" *ngIf="layer.visible === undefined || layer.visible === true"></span>
        <span uk-icon="icon: close" *ngIf="layer.visible === false"></span>
      </button>
      <button class="uk-button uk-button-danger uk-button-small" (click)="deleteLayer(layer)">
        <span uk-icon="icon: trash"></span>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #symboleditor let-symbol="symbol">
  <!--  Create three input boxes next to each other-->
  <div class="uk-grid uk-child-width-expand">
    <div>
      <label class="uk-form-label" for="screenLength">Screenlength</label>
      <div class="uk-form-controls">
        <input class="uk-input" id="screenLength" name="screenLength" type="number"
               [(ngModel)]="symbol.verticalOffset.screenLength">
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="maxWorldLength">Max world length</label>
      <div class="uk-form-controls">
        <input class="uk-input" id="maxWorldLength" name="maxWorldLength" type="number"
               [(ngModel)]="symbol.verticalOffset.maxWorldLength">
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="minWorldLength">Min world length</label>
      <div class="uk-form-controls">
        <input class="uk-input" id="minWorldLength" name="minWorldLength" type="number"
               [(ngModel)]="symbol.verticalOffset.minWorldLength">
      </div>
    </div>
  </div>
  <div class="uk-margin">
    <label class="uk-form-label" for="color">Material Color</label>
    <div class="uk-form-controls">
      <input class="uk-input" id="color" name="color" type="color"
             [(ngModel)]="symbol.symbolLayers[0].material.color">
    </div>
  </div>
  <div class="uk-grid uk-child-width-expand">
    <div>
      <label class="uk-form-label" for="outlineSize">Outline size</label>
      <div class="uk-form-controls">
        <input class="uk-input" id="outlineSize" name="outlineSize" type="number"
               [(ngModel)]="symbol.symbolLayers[0].outline.size">
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="outlineColor">Outline color</label>
      <div class="uk-form-controls">
        <input class="uk-input" id="outlineColor" name="outlineColor" type="color"
               [(ngModel)]="symbol.symbolLayers[0].outline.color">
      </div>
    </div>
  </div>
</ng-template>
